<%- layout('/layout/boilerplate.ejs') %>

<div class="portfolio-main">
  <div class="left-side">
    <h4 style="margin-left: 80px">Portfolio Summary</h4>
    <div class="asset-summary">
      <h4 class="mb-4">Current Holdings</h4>

      <% for(let company of testData) {%>
      <div class="asset">
        <div class="asset-left">
          <p><%= company.stockName %></p>
          <p class="text-muted">
            <%= company.noOfStock %> x Rs.<%= company.testStockPrice %>
          </p>
          <p>Current Price: <%= (company.currentPrice * 1).toFixed(2) %></p>
        </div>
        <div class="asset-right">
          <p>Total value: Rs <%= (company.totalValue * 1).toFixed(2) %></p>
          <p
            style="color: <%= company.totalValue - company.investedAmount > 0? 'green':'red' %> "
          >
            P/L: Rs<%= ((company.investedAmount - company.totalValue) *
            1).toFixed(2) %> (<%= company.pAndLossPerc %> %)
          </p>
        </div>
      </div>
      <% } %>
    </div>
  </div>

  <div class="tools">
    <div class="add-stock">
      <form action="/addStock" class="mb-3 add-stock-form" method="post">
        <div class="card card-bg">
          <div class="card-body">
            <h5 class="card-title">Add stock</h5>
            <div class="mb-1">
              <label for="companyName" class="form-label">Company Name:</label>
              <input
                type="text"
                class="form-control"
                id="companyName"
                name="company[companyName]"
                placeholder="Company Name"
              />
            </div>
            <div class="mb-3">
              <label for="quantity" class="form-label">Quantity</label>
              <input
                type="Number"
                class="form-control"
                id="quantity"
                placeholder="Quantity"
                name="company[quantity]"
              />
            </div>
            <button type="submit" class="btn btn-success">Add Stock</button>
          </div>
        </div>
      </form>
    </div>
    <div class="pie-chart">
      <h4>Asset Visualization</h4>
      <canvas id="myChart"></canvas>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const labelArray = "<%-stockLabel%>".split(",");
  const valueArray = "<%-stockValue%>".split(",");

  const labels = labelArray;

  const data = {
    labels: labels,
    datasets: [
      {
        label: "My First dataset",
        backgroundColor: [
          "rgba(0, 0, 255, 0.6)",
          "rgba(255, 0, 0, 0.6)",
          "rgba(0, 128, 0, 0.6)",
          "rgba(0, 0, 0, 0.6)",
          "rgb(255, 99, 132,0.6)",
          "rgba(245, 40, 145, 0.6)",
          "rgba(37, 36, 190, 0.6)",
          "rgba(0, 206, 255, 0.6)",
          "rgba(0, 255, 96, 0.6)",
          "rgba(22, 47, 15, 0.6)",

          ,
        ],
        borderColor: "rgb(255,255,255)",
        data: valueArray,
      },
    ],
  };

  const config = {
    type: "pie",
    data: data,
    options: {},
  };

  const myChart = new Chart(document.getElementById("myChart"), config);
</script>
